<Window x:Class="CATERINGMANAGEMENT.View.Windows.AssignWorker"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
         Height="800" Width="900"
        WindowStartupLocation="CenterScreen" Background="#FAFAFA"
        FontFamily="Calibri" FontSize="14">

    <Window.Resources>
        <!-- Converter -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="20*"/>
            <RowDefinition Height="229*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- LEFT SIDE: Reservation + Worker Assignment -->
        <DockPanel Grid.Column="0" LastChildFill="True" Margin="0,0,16,0" Grid.RowSpan="2">
            <!-- Buttons at bottom -->
            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0" >
                <Button Content="Cancel" Width="100"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Command="{Binding CancelCommand}"/>
                <Button Content="Assign Workers" Width="160" Background="#673AB7" Foreground="White" Margin="5,0,0,0"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Command="{Binding BatchAssignCommand}"/>
            </StackPanel>

            <StackPanel>
                <StackPanel Margin="10,0,0,16" HorizontalAlignment="Left">
                    <TextBlock Text="Select Reservation" FontWeight="Bold" FontSize="16" Margin="0,0,0,4"/>

                    <!-- Reservation Selector -->
                    <ComboBox ItemsSource="{Binding Reservations}"
                              DisplayMemberPath="Package.Name"
                              SelectedItem="{Binding SelectedReservation}"
                              Width="476" Height="36" FontSize="14"
                              materialDesign:HintAssist.Hint="Select Reservation"
                              Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>

                    <!-- Reservation Details -->
                    <StackPanel Orientation="Horizontal" Margin="4,6,0,0" VerticalAlignment="Center">
                        <TextBlock FontSize="14" Foreground="Gray" Margin="0,0,8,0"
                                   Text="{Binding SelectedReservation.EventDate, StringFormat='Date: {0:MMMM dd, yyyy}'}"/>

                        <!-- Vertical Separator -->
                        <Separator Width="5" Margin="2,0" Background="Gray" />

                        <TextBlock FontSize="14" Foreground="Gray" Margin="8,0,0,0"
                                   Text="{Binding SelectedReservation.Location, StringFormat='Location: {0}'}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Search Box -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10" HorizontalAlignment="Right">
                    <Border Background="White" CornerRadius="8" BorderBrush="#DDD" BorderThickness="1" Height="38" VerticalAlignment="Center">
                        <DockPanel Margin="4">
                            <!-- Search Icon -->
                            <materialDesign:PackIcon Kind="Magnify" Width="18" Height="18" VerticalAlignment="Center" Foreground="#666" Margin="0,0,6,0"/>

                            <!-- Search TextBox -->
                            <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                     Width="250"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="#333"
                                     FontSize="14"
                                     VerticalContentAlignment="Center"
                                     Padding="2"
                                     materialDesign:HintAssist.Hint="Search..."/>
                        </DockPanel>
                    </Border>
                </StackPanel>

                <!-- Workers list with its own scroll -->
                <TextBlock Text="Available Workers" FontWeight="Bold" FontSize="16" Margin="10,0,0,6"/>
                <ScrollViewer Height="300" VerticalScrollBarVisibility="Auto">
                    <Grid HorizontalAlignment="Center">
                        <ItemsControl ItemsSource="{Binding FilteredWorkers}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Width="250" Margin="2" Padding="10" Background="White"
                                            BorderBrush="#DDD" BorderThickness="1" CornerRadius="8">
                                        <Border.Effect>
                                            <DropShadowEffect ShadowDepth="2" BlurRadius="6" Opacity="0.18"/>
                                        </Border.Effect>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14"/>
                                            <TextBlock Text="{Binding Role}" Foreground="Gray" FontSize="12" Margin="0,4,0,0"/>
                                            <TextBlock Text="{Binding Contact}" Foreground="Gray" FontSize="12" Margin="0,2,0,6"/>
                                            <TextBlock Text="{Binding Email}" Foreground="Gray" FontSize="12" Margin="0,2,0,6"/>
                                            <Button Content="Assign"
                                                    Padding="6,3"
                                                    Command="{Binding DataContext.AssignWorkerCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>
                </ScrollViewer>

                <!-- Selected Workers -->
                <GroupBox Header="Selected Workers" Margin="0,12,0,0">
                    <ScrollViewer Height="150" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding AssignedWorkers}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <!-- Worker Info -->
                                            <ColumnDefinition Width="Auto"/>
                                            <!-- Remove Button -->
                                        </Grid.ColumnDefinitions>

                                        <!-- Worker Info -->
                                        <StackPanel Orientation="Horizontal" Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                            <TextBlock Text=" - " />
                                            <TextBlock Text="{Binding Role}" Foreground="Gray"/>
                                        </StackPanel>

                                        <!-- Remove Button -->
                                        <Button Grid.Column="1"
                                Width="28" Height="28"
                                Style="{StaticResource MaterialDesignIconButton}"
                                ToolTip="Remove Worker"
                                Command="{Binding DataContext.RemoveAssignedWorkerCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                CommandParameter="{Binding}">
                                            <materialDesign:PackIcon Kind="CloseCircle"
                                                     Foreground="Red"
                                                     Width="20"
                                                     Height="20"
                                                     VerticalAlignment="Center"
                                                     HorizontalAlignment="Center"/>
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </GroupBox>


            </StackPanel>
        </DockPanel>

        <!-- LOADING OVERLAY -->
        <Border Grid.RowSpan="2"
                Background="#80000000"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                CornerRadius="8">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        >
                <!-- Circular Spinner -->
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                              IsIndeterminate="True"
                              Width="60"
                              Height="60"
                              Foreground="White  "/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
